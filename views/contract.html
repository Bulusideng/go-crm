<!DOCTYPE html>
<html>
 {{template "mheader"}}
  <title> 客户管理 - 更新客户</title>  
  </head>
  <body class="mbr-white cid-qzO6FIBSpg mbr-fullscreen mbr-parallax-background" id="header2-2" data-rv-view="38">
	<!--Disable form if not adim/manager or customer's worker-->
    <div id="container" class="container" 
	{{if or (or (or (eq .CurUser.Title "Admin") (eq .CurUser.Title "Manager")) (eq .CurUser.Uname .Contract.Secretary)) (eq .CurUser.Uname .Contract.Consulter)}}
	{{else}}
	disabled=true  
	{{end}}
	>
		</br><h3 class="text-center" >客户详情</h3>
        <form class="col-xs-4" method="post" action="/contract?op=update" onsubmit="postSubmit()" enctype="multipart/form-data">
			{{$Team := .Team}}
			{{$CurUser := .CurUser}}
			{{with .Contract}}
            <div class="form-group">
                <label>合同号:</label>
                <input type="number" class="form-control" name="Contract_id" value={{.Contract_id}} readonly>
            </div>
            <div class="form-group">
                <label>序号:</label>
                <input type="number" class="form-control" name="Seq" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}} value={{.Seq}}>
            </div>
            <div class="form-group">
                <label>客户姓名:</label>
                <input type="text" class="form-control" name="Client_name" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}} value={{.Client_name}}>
            </div>
			<div class="form-group">
                <label>国家:</label>
				<select id="Country" type="text" class="form-control" name="Country" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}} required value={{.Country}}>
				{{template "country_select"}}
            </div>
			<div class="form-group">
                <label>项目:</label>
                <input type="text" class="form-control" name="Project_type" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}} value={{.Project_type}}>
            </div>
			<div class="form-group">
                <label>客户电话:</label>
                <input type="text" class="form-control" name="Client_tel" value={{.Client_tel}}>
            </div>
			<div class="form-group">
                <label>转案日期:</label>
                <input type="date" class="form-control" name="Zhuan_an_date" value={{.Zhuan_an_date}}>
            </div>
			<div class="form-group">
                <label>咨询:</label>
				<select class="form-control" id="Consulter" name="Consulter" required="required" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}}>
				<option value = "N/A">N/A</option>
				{{$cons := .Consulter}}
				{{range $Team}}
				<option value = {{.Uname}} {{if eq $cons .Uname}} selected="selected" {{end}}>{{.Uname}}: {{.Cname}}</option>
				{{end}}
				</select>
            </div>
			<div class="form-group">
                <label>文案:</label>
				<select class="form-control" id="Secretary" name="Secretary" required="required" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}}>
				<option value = "N/A">N/A</option>
				{{$sec := .Secretary}}
				{{range $Team}}
				<option value = {{.Uname}} {{if eq $sec .Uname}} selected="selected" {{end}}>{{.Uname}}: {{.Cname}}</option>
				{{end}}
				</select>
            </div>
			<div class="form-group">
                <label>录入人:</label>
                <input type="number" class="form-control" name="Create_by" disabled="disabled" value={{.Create_by}}>
            </div>
			<div class="form-group">
                <label>录入日期:</label>
                <input type="number" class="form-control" name="Create_date" disabled="disabled" value={{.Create_date}}>
            </div>
			<div class="form-group">
                <label>状态:</label>
                <input type="text" class="form-control" name="Current_state" value={{.Current_state}}>
            </div>
			
            <div style="display:none" class="form-group">
                <label>附件:</label>
                <input type="file" class="form-control" name="attachment" >
            </div>
			{{end}}


			<div class="form-group">
                <label>更新:</label>
                <input type="textarea" class="form-control" name="NewComment">
            </div>
            <center>
				<button type="submit" class="btn  btn-danger">更新</button>
				{{if eq .CurUser.Title "Manager"}}
				<a class="btn  btn-danger" href="/contract/delete?cid={{.Contract.Contract_id}}" onclick="return doConfirm()">删除</a>
				{{end}}
				<a id="#toBotton" class="btn  btn-danger" href="/contract">返回</a>
			</center>
        </form>
		
		<h4>历史记录:</h3>
		<ol>
		 {{range .Comments}}
			<li>
				<b>{{.Cname}}[{{.Uname}}] - [{{.Date}}]: {{.Content}}</b></br>
				{{if ne .Changes ""}}
				状态变化: {{.Changes}}
				{{end}}
				
			</li>
			{{end}}
		</ol>
		
    </div>

  </body>
	<script>
	$(document).ready(function () {//If no permission, disable edit
		if ($('#container').attr('disabled')) {
			$('#container').find('input, textarea, button, select').attr('disabled',true);
		}
    });
	
	function postSubmit()
	{
		$('#container').find('input, textarea, button, select').attr('disabled',false);	
	}
	
</script>


<script type="text/javascript" src="/static/js/my.js"></script>
</html>
