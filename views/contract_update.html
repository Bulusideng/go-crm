<!DOCTYPE html>
<html>
 {{template "header"}}
  <title> 项目管理 - 更新合同</title>  
  </head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            {{template "navbar" .}}
        </div>
    </nav>

    <div class="container">
		<h3 class="text-center" >更新客户状态</h3>
        <form method="post" action="/contract" onsubmit="checkForm()" enctype="multipart/form-data">
			<input style="display:none" type="text" class="form-control" name="OP" value="UPDATE">
			{{$Team := .Team}}
			{{$CurUser := .CurUser}}
			{{with .Contract}}
            <div class="form-group">
                <label>合同号:</label>
                <input type="number" class="form-control" name="Contract_id" value={{.Contract_id}} readonly>
            </div>
            <div class="form-group">
                <label>序号:</label>
                <input type="number" class="form-control" name="Seq" value={{.Seq}}>
            </div>
            <div class="form-group">
                <label>客户姓名:</label>
                <input type="text" class="form-control" name="Client_name" value={{.Client_name}}>
            </div>
			<div class="form-group">
                <label>客户电话:</label>
                <input type="text" class="form-control" name="Client_tel" value={{.Client_tel}}>
            </div>
			<div class="form-group">
                <label>国家:</label>
                <input type="text" class="form-control" name="Country" value={{.Country}}>
            </div>
			<div class="form-group">
                <label>项目:</label>
                <input type="text" class="form-control" name="Project_type" value={{.Project_type}}>
            </div>
			<div class="form-group">
                <label>咨询:</label>
				<select class="form-control" id="Consulter" name="Consulter" required="required" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}}>
				{{$cons := .Consulter}}
				{{range $Team}}
				<option value = {{.Uname}} {{if eq $cons .Uname}} selected="selected" {{end}}>{{.Uname}}: {{.Cname}}</option>
				{{end}}
				</select>
            </div>
			<div class="form-group">
                <label>文案:</label>
				<select class="form-control" id="Secretary" name="Secretary" required="required" {{if ne $CurUser.Title "Manager"}} disabled="disabled" {{end}}>
				<option value = "N/A">N/A</option>
				{{$sec := .Secretary}}
				{{range $Team}}
				<option value = {{.Uname}} {{if eq $sec .Uname}} selected="selected" {{end}}>{{.Uname}}: {{.Cname}}</option>
				{{end}}
				</select>
            </div>
			<div class="form-group">
                <label>转案日期:</label>
                <input type="date" class="form-control" name="Zhuan_an_date" value={{.Zhuan_an_date}}>
            </div>
			<div class="form-group">
                <label>状态:</label>
                <input type="text" class="form-control" name="Current_state" value={{.Current_state}}>
            </div>
			
            <div style="display:none" class="form-group">
                <label>文章附件:</label>
                <input type="file" class="form-control" name="attachment" >
            </div>
			{{end}}
			<div class="form-group">
                <label>历史记录:</label>
				<div class="container-fluid">
					<div class="row-fluid">
						<div class="span12">
							<ol>
							 {{range .Comments}}
								<li>
									{{.Date}} {{.Title}}:{{.Cname}}[{{.Uname}}]:</br>
									{{.Changes}}
									{{.Content}}
								</li>
								{{end}}
							</ol>
						</div>
					</div>
				</div>				
            </div>
			
			<div class="form-group">
                <label>更新:</label>
                <input type="textarea" class="form-control" name="NewComment">
            </div>
            <center>
				<button type="submit" class="btn  btn-danger">确定</button>
				<a class="btn  btn-danger" href="/contract">取消</a>
			</center>
        </form>
    </div>
  </body>
	<script>
	function checkForm()
	{
		document.getElementById("Consulter").disabled=false
		document.getElementById("Secretary").disabled=false
	}
</script>
</html>
